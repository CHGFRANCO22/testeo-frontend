<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Gestor Clínico - Escritorio</title>
  <style>
    * {
      box-sizing: border-box;
    }
    body {
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      background-color: #f4f6f9;
      color: #333;
    }

    #sidebar {
      width: 240px;
      background: #2c3e50;
      color: white;
      height: 100vh;
      position: fixed;
      top: 0;
      left: 0;
      padding-top: 60px;
      transition: transform 0.3s ease;
      box-shadow: 2px 0 10px rgba(0, 0, 0, 0.2);
      z-index: 100;
    }

    #sidebar.hide {
      transform: translateX(-100%);
    }

    #sidebar ul {
      list-style: none;
      padding: 0;
    }

    #sidebar ul li {
      padding: 15px 25px;
      cursor: pointer;
      transition: background 0.3s;
    }

    #sidebar ul li:hover {
      background: #1abc9c;
    }

    #logoutBtn {
      background: #e74c3c;
      border: none;
      color: white;
      padding: 12px 25px;
      margin: 30px 25px;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.3s;
    }

    #logoutBtn:hover {
      background: #c0392b;
    }

    #topbar {
      display: flex;
      align-items: center;
      padding: 15px 20px;
      background-color: white;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 999;
      height: 60px;
    }

    #toggle-btn {
      background: #3498db;
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 18px;
      margin-right: 20px;
      transition: transform 0.3s ease;
    }

    #toggle-btn.rotated {
      transform: rotate(90deg);
    }

    #content {
      padding: 20px;
      padding-top: 80px; /* evita que el navbar lo tape */
      padding-left: 260px;
      transition: padding-left 0.3s ease;
    }

    .sidebar-hidden #content {
      padding-left: 20px;
    }

    .section {
      background: white;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      margin-bottom: 30px;
    }

    h2 {
      margin-top: 0;
      font-size: 24px;
      color: #2c3e50;
    }

    button {
      margin: 10px 10px 10px 0;
      padding: 10px 20px;
      border: none;
      background-color: #3498db;
      color: white;
      border-radius: 6px;
      cursor: pointer;
      transition: background 0.3s;
    }

    button:hover {
      background-color: #2980b9;
    }

    @media (max-width: 768px) {
      #sidebar {
        transform: translateX(-100%);
      }
      #sidebar.show {
        transform: translateX(0);
      }
      #content {
        padding-left: 20px !important;
      }
    }
  </style>
</head>
<body>

<div id="sidebar">
  <ul id="menuList">
    <li onclick="showSection('pacientes')">Pacientes</li>
    <li onclick="showSection('turnos')">Turnos</li>
    <li onclick="showSection('agenda')">Agenda</li>
    <li onclick="showSection('perfil')">Perfil</li>
  </ul>
  <button id="logoutBtn">Cerrar sesión</button>
</div>

<div id="topbar">
  <button id="toggle-btn">☰</button>
  <h2 style="margin: 0;">Gestor Clínico - Escritorio</h2>
</div>

<div id="content">
  <div id="pacientes" class="section">
    <h2>Gestión de Pacientes</h2>
    <button onclick="listarPacientes()">Listar Pacientes</button>
    <button onclick="crearPaciente()">Registrar Paciente</button>
    <div id="pacientesResultado" style="margin-top: 20px;"></div>
  </div>

  <div id="turnos" class="section" style="display:none">
    <h2>Turnos</h2>
  </div>

  <div id="agenda" class="section" style="display:none">
    <h2>Agenda Médica</h2>
  </div>

  <div id="perfil" class="section" style="display:none">
    <h2>Perfil de Usuario</h2>
  </div>
</div>

<script>
  const token = localStorage.getItem("token");
  const usuario = JSON.parse(localStorage.getItem("usuario"));
  if (!token || !usuario) {
    window.location.href = "login.html";
  }

  if (usuario.rol === "secretaria") {
    document.getElementById("pacientes")?.remove();
    document.getElementById("perfil")?.remove();
    const menu = document.getElementById("menuList");
    menu.querySelector("li[onclick=\"showSection('pacientes')\"]")?.remove();
    menu.querySelector("li[onclick=\"showSection('perfil')\"]")?.remove();
  }

  const sidebar = document.getElementById('sidebar');
  const toggleBtn = document.getElementById('toggle-btn');
  const body = document.body;
  const sections = document.querySelectorAll('.section');

  toggleBtn.onclick = () => {
    sidebar.classList.toggle('hide');
    body.classList.toggle('sidebar-hidden');
    toggleBtn.classList.toggle('rotated');
  };

  function showSection(sectionId) {
    sections.forEach(s => {
      s.style.display = s.id === sectionId ? 'block' : 'none';
    });
  }

  document.getElementById('logoutBtn').addEventListener('click', () => {
    localStorage.clear();
    window.electronAPI.logout();
  });

  async function listarPacientes() {
    try {
      const res = await fetch("http://localhost:3000/api/pacientes", {
        headers: { Authorization: `Bearer ${token}` },
      });

      const pacientes = await res.json();

      const resultado = pacientes.map(p =>
        `<p>${p.nombre_completo} - DNI: ${p.dni}</p>`
      ).join("");

      document.getElementById("pacientesResultado").innerHTML = resultado;
    } catch (err) {
      console.error("Error al listar pacientes:", err);
    }
  }

  function crearPaciente() {
    alert("Formulario para registrar paciente (próximamente)");
  }
</script>

</body>
</html>
