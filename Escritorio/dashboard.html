<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Dashboard Salud Total</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      display: flex;
    }
    #sidebar {
      width: 220px;
      background: #2c3e50;
      color: white;
      height: 100vh;
      position: fixed;
      top: 0; left: 0;
      padding-top: 60px;
      transition: transform 0.3s ease;
    }
    #sidebar.hide {
      transform: translateX(-220px);
    }
    #sidebar ul {
      list-style: none;
      padding: 0;
    }
    #sidebar ul li {
      padding: 15px 20px;
      cursor: pointer;
    }
    #sidebar ul li:hover {
      background: #34495e;
    }
    #content {
      margin-left: 220px;
      padding: 20px;
      flex-grow: 1;
    }
    #toggle-btn {
      position: fixed;
      top: 10px;
      left: 10px;
      background: #3498db;
      color: white;
      border: none;
      padding: 10px;
      cursor: pointer;
      z-index: 1000;
    }
  </style>
</head>
<body>

<button id="toggle-btn">☰</button>

<div id="sidebar">
  <ul id="menuList">
    <li onclick="showSection('pacientes')">Pacientes</li>
    <li onclick="showSection('turnos')">Turnos</li>
    <li onclick="showSection('agenda')">Agenda</li>
    <li onclick="showSection('perfil')">Perfil</li>
  </ul>
  <button id="logoutBtn" style="margin: 20px;">Cerrar sesión</button>
</div>

<div id="content">
  <div id="pacientes" class="section">
    <h2>Gestión de Pacientes</h2>
    <button onclick="listarPacientes()">Listar Pacientes</button>
    <button onclick="crearPaciente()">Registrar Paciente</button>
    <div id="pacientesResultado"></div>
  </div>

  <div id="turnos" class="section" style="display:none">
    <h2>Turnos</h2>
  </div>

  <div id="agenda" class="section" style="display:none">
    <h2>Agenda Médica</h2>
  </div>

  <div id="perfil" class="section" style="display:none">
    <h2>Perfil de Usuario</h2>
  </div>
</div>

<script>
  // Verificar token y redirigir si no hay sesión
  const token = localStorage.getItem("token");
  const usuario = JSON.parse(localStorage.getItem("usuario"));
  if (!token || !usuario) {
    window.location.href = "login.html";
  }

  // Mostrar/ocultar secciones según el rol
  if (usuario.rol === "admin") {
    // Mostrar todo
  } else if (usuario.rol === "secretaria") {
    document.getElementById("pacientes")?.remove();
    document.getElementById("perfil")?.remove();

    const menu = document.getElementById("menuList");
    menu.querySelector("li[onclick=\"showSection('pacientes')\"]")?.remove();
    menu.querySelector("li[onclick=\"showSection('perfil')\"]")?.remove();
  }

  // Toggle sidebar
  const sidebar = document.getElementById('sidebar');
  const toggleBtn = document.getElementById('toggle-btn');
  const sections = document.querySelectorAll('.section');

  toggleBtn.onclick = () => {
    sidebar.classList.toggle('hide');
  };

  function showSection(sectionId) {
    sections.forEach(s => {
      s.style.display = s.id === sectionId ? 'block' : 'none';
    });
  }

  // Cerrar sesión
  document.getElementById('logoutBtn').addEventListener('click', () => {
    localStorage.removeItem("token");
    localStorage.removeItem("usuario");
    window.location.href = "login.html";
  });

  // Función para listar pacientes (solo admin)
  async function listarPacientes() {
    try {
      const res = await fetch("http://localhost:3000/api/pacientes", {
        headers: { Authorization: `Bearer ${token}` },
      });

      const pacientes = await res.json();

      const resultado = pacientes.map(p =>
        `<p>${p.nombre_completo} - DNI: ${p.dni}</p>`
      ).join("");

      document.getElementById("pacientesResultado").innerHTML = resultado;
    } catch (err) {
      console.error("Error al listar pacientes:", err);
    }
  }

  // Próxima implementación
  function crearPaciente() {
    alert("Formulario para registrar paciente (próximamente)");
  }
</script>

</body>
</html>
